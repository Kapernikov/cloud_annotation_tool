name: cloud-annotation-tool
version: '0.2'
base: core20
summary: Single-line elevator pitch for your amazing snap
description: This is my-snap's description. You have a paragraph or two to tell the
grade: devel
confinement: devmode

apps:
  cloud-annotation-tool:
     command: usr/local/bin/cloud_annotation_tool
     command-chain: [ bin/desktop-launch ]
     plugs:
       - home
       - opengl
       - pulseaudio
       - x11
       - desktop
       - desktop-legacy
       - wayland


parts:
  desktop-qt5:
    source: https://github.com/ubuntu/snapcraft-desktop-helpers.git
    source-subdir: qt
    plugin: make
    make-parameters: ["FLAVOR=qt5"]
    build-packages:
      - build-essential
      - qtbase5-dev
      - dpkg-dev
    stage-packages:
      - libxkbcommon0
      - ttf-ubuntu-font-family
      - dmz-cursor-theme
      - light-themes
      - adwaita-icon-theme
      - gnome-themes-standard
      - shared-mime-info
      - libqt5gui5
      - libgdk-pixbuf2.0-0
      - libqt5svg5 # for loading icon themes which are svg
      - try: [appmenu-qt5] # not available on core18
      - locales-all
      - xdg-user-dirs
      - fcitx-frontend-qt5

  qt5-xdgdesktopportal-platform:
    plugin: nil
    stage-packages:
      - qt5-xdgdesktopportal-platformtheme


  qtwayland:
    source: https://github.com/qt/qtwayland.git
    source-depth: 1
    source-tag: v5.12.8
    plugin: dump
    override-build: |
      qmake
      make -j$(nproc)
      make INSTALL_ROOT="$SNAPCRAFT_PART_INSTALL" install
    after:
      - desktop-qt5
    stage: [-./usr/lib]
    prime: [-./*]

  vtk:
    plugin: cmake
    source: https://github.com/Kitware/VTK.git
    source-type: git
    source-branch: v8.2.0
    after: [qtwayland, desktop-qt5]
    cmake-parameters:
      - -DCMAKE_BUILD_TYPE=Release 
      - -DBUILD_TESTING=OFF 
      - -DVTK_Group_Qt=ON 
      - -DVTK_Group_Rendering=ON 
      - -DVTK_Group_Views=ON 
      - -DVTK_Group_MPI=ON 
      - -DVTK_PYTHON_VERSION=3 
      - -DVTK_WRAP_PYTHON=OFF
      - -DCMAKE_INSTALL_PREFIX=/usr
    stage-packages:
      - qt5dxcb-plugin
      - libqt5gui5
      - libpng16-16
      - libqhull7
      - libqt5opengl5
      - libqt5x11extras5
      - libswscale5
      - libavformat58
      - libopenni0
      - libopenni2-0
      - python3-minimal
      - libxt6
      - libhwloc15
      - libltdl7
      - libopenmpi3
      - libpython3.9
    build-packages: 
      - build-essential 
      - cmake 
      - qttools5-dev-tools 
      - libqt5opengl5-dev 
      - qttools5-dev
      - libqt5x11extras5-dev 
      - libxt-dev
      - qtbase5-dev 
      - python3-dev 
      - python3-pip 
      - git 
      - wget
      - unzip 
      - yasm 
      - libpng-dev 
      - libavformat-dev 
      - libtiff-dev 
      - libswscale-dev 
      - llvm-dev 
      - libeigen3-dev 
      - libflann-dev 
      - libqhull-dev 
      - libopenni-dev 
      - libboost-dev
      - libboost-system-dev 
      - libboost-filesystem-dev 
      - libboost-thread-dev 
      - libboost-date-time-dev 
      - libboost-iostreams-dev

  pcl:
      after: [vtk]
      source: https://github.com/PointCloudLibrary/pcl
      source-type: git
      source-branch: pcl-1.11.1
      plugin: cmake
      stage-packages:
        - libusb-1.0-0
        - libglu1-mesa
        - libboost-chrono1.71.0
        - libboost-filesystem1.71.0
        - libboost-iostreams1.71.0
        - libboost-system1.71.0
        - libboost-thread1.71.0
        - libflann1.9
        
      build-packages:
        - libusb-dev 
        - libusb-1.0-0-dev
      cmake-parameters:
        - -DCMAKE_BUILD_TYPE=Release 
        - -DBUILD_features=ON 
        - -DBUILD_filters=ON 
        - -DBUILD_geometry=ON 
        - -DBUILD_search=ON 
        - -DBUILD_tools=OFF
        - -DBUILD_visualization=ON 
        - -DBUILD_tracking=ON 
        - -DBUILD_apps=OFF
        - -DPCL_QT_VERSION=5 
        - -DBUILD_apps_point_cloud_editor=OFF
        - -DCMAKE_INSTALL_PREFIX=/usr

  annotationtool:
      after: [vtk, pcl]
      source: .
      plugin: cmake
      build-environment:
        - LD_LIBRARY_PATH: /root/stage/usr/lib/
    
